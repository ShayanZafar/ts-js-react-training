import { FullScreenCode, Invert } from "mdx-deck/layouts";
import ReplIt from "../../components/replit";
import CodeSandbox from "../../components/codesandbox";
import Box from "../../components/Box";
import { Head, Appear, Image, withDeck } from 'mdx-deck'
import { CodeSurfer } from "mdx-deck-code-surfer";
import nightOwl from "prism-react-renderer/themes/nightOwl";
const BRANCH_NAME = 'es-100-react-reorder-events-class-content'

export default Invert

# React Class Components - Intro 

---

# React.Component 

Class that extends from React.Component, which has:

*  `state` property
*  `render` method 
*  `this.setState` method to modify state

---

<CodeSandbox src={`https://codesandbox.io/embed/github/e-schultz/ts-js-react-training/tree/${BRANCH_NAME}/examples/react-class-state-01?autoresize=1&codemirror=1&fontsize=14&module=%2Fsrc%2Findex%2FName.js`}/>

---

## Reading and Writing State

* The value of a component's state is modified using the `setState` method
* `setState` is only available on stateful components
* Component state can be accessed from the `state` object (`this.state`)

---

## Setting State 

`setState` can be called in two ways:

* By providing an object 

```jsx
this.setState({
  items: [1,2,3]
})
```

---

## Setting State 

`setState` can be called in two ways:

* By providing a updater method 

```jsx
this.setState((state)=>({
 items: state.items.map(n=>n*2)
}))
```

---

## When to use the updater?

* If the your next state depends on the current state
* React will provide the current state at the time it is being applied
* When not using the updated, `this.state` will refer to the state at the time setState was callled
* [React setState documentation for deeper dive](https://reactjs.org/docs/react-component.html#setstate)

---

export default Invert

# Handling Events

---

## Events in React

- React provides APIs for dealing with events, called [SyntheticEvents](https://reactjs.org/docs/events.html)
- Events are cross-browser compatible
- Same interface as the browser native events
- Use `camelCase` to attach handlers

---

## Common React Events

- `onClick`
- `onKeyUp`
- `onChange`
- `onInput`
- `onSubmit`

... [and more](https://reactjs.org/docs/events.html)

---

## Event Handlers

- Using JSX, you can attach handler functions to events
- Event handlers will implicitly receive the event object as a parameter

---

<CodeSurfer
  code={require("!raw-loader!./snippets/events-intro.snippet")}
  theme={nightOwl}
  lang="jsx"
  title="Events in React"
  showNumbers
  steps={[
    {},
    {lines: [2,3,4,5], notes: "Our event handler - we want it to run when the event triggers"},
    {lines: [8], notes: "We attach the handler WITHOUT invoking it" },
    {lines: [2], notes: "It will receive a prop, event" },
    {lines: [3], notes: "It's a JavaScript event with expected methods" },
    {lines: [4], notes: "Log when the button is clicked" },
    {}
  ]}
/>

---

<CodeSurfer
  code={require("!raw-loader!./snippets/event-target.snippet")}
  theme={nightOwl}
  lang="jsx"
  title="Event Values"
  showNumbers
  steps={[
    {},
    {lines: [], notes: "If we want the value of an event..."},
    {lines: [3], notes: "We read it from the event object" },
    {lines: [4], notes: "Then we can use it" },
    {}
  ]}
/>

---

## Passing other arguments to event handlers

- Use an arrow function that receives the event explicitly and returns your callback
- Add any additional parameters you need here
- You can pass the event through, or ignore it if you don't need it

---

<CodeSurfer
  code={require("!raw-loader!./snippets/event-with-param.snippet")}
  theme={nightOwl}
  lang="jsx"
  title="Events with Extra Parameters"
  showNumbers
  steps={[
    {},
    {lines: [3], notes: "We want to log the row ID when the button is clicked"},
    {lines: [8], notes: "Use an anonymous function that returns our handler" },
    {lines: [8], notes: "Pass the event and our extra param" },
    {}
  ]}
/>

---
export default  FullScreenCode

## Practice - Input / Click Handler

<CodeSandbox src={`https://codesandbox.io/embed/github/e-schultz/ts-js-react-training/tree/master/exercises/react-events-start?autoresize=1&codemirror=1&fontsize=14&module=%2Fsrc%2Fcomponents%2FName.js`}/>

---
export default  FullScreenCode

## Practice - Input / Click Handler - Solution

<CodeSandbox src={`https://codesandbox.io/embed/github/e-schultz/ts-js-react-training/tree/master/exercises/react-events-end?autoresize=1&codemirror=1&fontsize=14&module=%2Fsrc%2Fcomponents%2FName.js`}/>

---
## Unidirectional Data Flow

* Data is passed down with props
* Callbacks are passed down and invoked to notify of changes
* Or Events are emitted

---

```
+------------------------------------+
|                                    |
| App                                |
|            Props        Callback   |
|              |             ^       |
|              |             |       |
|              |             |       |
|              Ë‡             |       |
|            +-------------------+   |
|            | Person            |   |
|            |                   |   |
|            |                   |   |
|            +-------------------+   |
|                                    |
+------------------------------------+

```
---

### Example - Removing Item from List

<Box style={{width: "80vw"}}>
  <CodeSandbox src={`https://codesandbox.io/embed/github/e-schultz/ts-js-react-training/tree/${BRANCH_NAME}/examples/react-list-example-remove-item?autoresize=1&codemirror=1&fontsize=14&module=%2Fsrc%2FApp.js`}/>
</Box>

---

### Why should the Parent handle the change?

* The child notifies that we want to be done.
* The parent controls how it is done.
* The parent provided the data - so it controls how it is updated

---
### Example - Use confirm to control if the item is removed

<Box style={{width: "80vw"}}>
  <CodeSandbox src={`https://codesandbox.io/embed/github/e-schultz/ts-js-react-training/tree/${BRANCH_NAME}/examples/react-list-example-remove-item?autoresize=1&codemirror=1&fontsize=14&module=%2Fsrc%2FApp.js`}/>
</Box>

---

### Exercise - Add "Remove" functionality to the Robot List 

* Modify the Robot Card / List
* Add a Remove Button to the Robot Card
* Add a callback prop 
* Modify the parent to remove the Robot once the button is clicked

---

### Exercise - Robot List Remove - Start 

<Box style={{width: "80vw"}}>
  <CodeSandbox src={`https://codesandbox.io/embed/github/e-schultz/ts-js-react-training/tree/${BRANCH_NAME}/exercises//events-robot-list-remove-robot-start?autoresize=1&codemirror=1&fontsize=14&module=%2Fsrc%2FApp.js`}/>
</Box>

---

### Exercise - Robot List Remove - Solution 

<Box style={{width: "80vw"}}>
  <CodeSandbox src={`https://codesandbox.io/embed/github/e-schultz/ts-js-react-training/tree/${BRANCH_NAME}/exercises//events-robot-list-remove-robot-end?autoresize=1&codemirror=1&fontsize=14&module=%2Fsrc%2FApp.js`}/>
</Box>

---

## setState is Asynchronous

* Changes to state will not be available right away
* setState's second argument is a callback that can be used to avoid issues with this

---

## Without Callback

```jsx
handleCountChange(value) {
  this.setState({ helloWorldCount: value })
  // This will log the old value
  console.log(this.state.helloWorldCount)
}
```

---


## With Callback

```jsx
handleCountChange(value) {
  this.setState(
    { helloWorldCount: value },
    // This will log the new value
    () => { console.log(this.state.helloWorldCount) }
  )
}
```

---

